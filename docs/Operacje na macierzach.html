<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operacje na Macierzach - Układ Poziomy</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f3f4f6;
            --panel-bg: #ffffff;
            --border-color: #d1d5db;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 10px;
            color: #1f2937;
        }

        .container {
            max-width: 1200px; /* Szerszy kontener, żeby zmieścić wynik obok */
            margin: 0 auto;
            background-color: var(--panel-bg);
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Zakładki */
        .tabs {
            display: flex;
            background-color: #e5e7eb;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #4b5563;
            transition: all 0.3s;
        }

        .tab-button:hover { background-color: #d1d5db; }

        .tab-button.active {
            background-color: var(--panel-bg);
            color: var(--primary-color);
            border-top: 3px solid var(--primary-color);
        }

        /* Treść */
        .tab-content {
            display: none;
            padding: 20px;
        }
        .tab-content.active { display: block; }

        /* Kontrolki na górze */
        .controls {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9fafb;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }

        label { font-weight: 500; margin-right: 5px; font-size: 0.9em; }

        input[type="number"] {
            padding: 4px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: 50px;
            text-align: center;
        }

        button.action-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button.action-btn:hover { background-color: #1d4ed8; }

        /* GŁÓWNY UKŁAD RÓWNANIA (Poziomy) */
        .equation-container {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap; /* Pozwala na zawijanie na małych ekranach */
            gap: 15px;
            margin-bottom: 25px;
            padding: 10px;
            min-height: 150px; /* Rezerwacja miejsca */
        }

        .operator, .equals {
            font-size: 28px;
            font-weight: bold;
            color: #4b5563;
            margin: 0 5px;
        }

        /* Macierze */
        .matrix-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .matrix-label {
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.85em;
            color: #6b7280;
        }

        .matrix-brackets {
            position: relative;
            padding: 8px;
            border-left: 2px solid #000;
            border-right: 2px solid #000;
            border-radius: 8px;
            background: #fff;
        }
        
        .matrix-brackets::before, .matrix-brackets::after {
            content: ''; position: absolute; width: 8px; height: 2px; background-color: #000;
        }
        .matrix-brackets::before { top: 0; left: 0; }
        .matrix-brackets::after { bottom: 0; left: 0; }
        
        .matrix-brackets .hook-right-top, .matrix-brackets .hook-right-bottom {
            position: absolute; width: 8px; height: 2px; background-color: #000; right: 0;
        }
        .matrix-brackets .hook-right-top { top: 0; }
        .matrix-brackets .hook-right-bottom { bottom: 0; }

        .matrix-grid {
            display: grid;
            gap: 4px;
        }

        .matrix-cell {
            width: 45px;
            height: 35px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 14px;
        }

        /* Styl dla wyniku */
        .result-cell {
            background-color: #dbeafe;
            color: #1e40af;
            font-weight: bold;
            border-color: #93c5fd;
        }

        /* SEKCJA KROKÓW (Kompaktowa) */
        .explanation-section {
            background-color: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .explanation-header {
            font-size: 0.9em;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Pola kroków - szersze tekstowe */
        .step-cell {
            width: auto;
            min-width: 60px;
            max-width: 140px;
            height: auto;
            min-height: 35px;
            padding: 4px;
            font-size: 12px;
            background: transparent;
            border: 1px dashed #d97706;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        /* Ukrywanie pustych placeholderów */
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-button active" onclick="openTab('add')">Dodawanie</button>
        <button class="tab-button" onclick="openTab('sub')">Odejmowanie</button>
        <button class="tab-button" onclick="openTab('scalar')">Mnożenie przez skalar</button>
        <button class="tab-button" onclick="openTab('mul')">Mnożenie macierzy</button>
    </div>

    <div id="add" class="tab-content active">
        <div class="controls">
            <label>Wiersze:</label> <input type="number" id="add-rows" value="2" min="1" max="5" onchange="resetAndRender('add')">
            <label>Kolumny:</label> <input type="number" id="add-cols" value="2" min="1" max="5" onchange="resetAndRender('add')">
            <button class="action-btn" onclick="calculate('add')">Oblicz wynik</button>
        </div>
        
        <div class="equation-container">
            <div id="add-A-container"></div>
            <div class="operator">+</div>
            <div id="add-B-container"></div>
            <div class="equals">=</div>
            <div id="add-Result-container"></div> </div>

        <div id="add-steps-wrapper" class="explanation-section hidden">
            <div class="explanation-header">Sposób obliczeń</div>
            <div id="add-steps-container"></div>
        </div>
    </div>

    <div id="sub" class="tab-content">
        <div class="controls">
            <label>Wiersze:</label> <input type="number" id="sub-rows" value="2" min="1" max="5" onchange="resetAndRender('sub')">
            <label>Kolumny:</label> <input type="number" id="sub-cols" value="2" min="1" max="5" onchange="resetAndRender('sub')">
            <button class="action-btn" onclick="calculate('sub')">Oblicz wynik</button>
        </div>

        <div class="equation-container">
            <div id="sub-A-container"></div>
            <div class="operator">-</div>
            <div id="sub-B-container"></div>
            <div class="equals">=</div>
            <div id="sub-Result-container"></div>
        </div>

        <div id="sub-steps-wrapper" class="explanation-section hidden">
            <div class="explanation-header">Sposób obliczeń</div>
            <div id="sub-steps-container"></div>
        </div>
    </div>

    <div id="scalar" class="tab-content">
        <div class="controls">
            <label>Wiersze:</label> <input type="number" id="scal-rows" value="2" min="1" max="5" onchange="resetAndRender('scalar')">
            <label>Kolumny:</label> <input type="number" id="scal-cols" value="2" min="1" max="5" onchange="resetAndRender('scalar')">
            <div style="border-left: 1px solid #ccc; padding-left: 10px; margin-left: 10px;">
                <label>Skalar (k):</label> <input type="number" id="scal-val" value="3" style="width: 50px;">
            </div>
            <button class="action-btn" onclick="calculate('scalar')">Oblicz wynik</button>
        </div>

        <div class="equation-container">
            <div class="operator" style="font-size:1.5em">k &times;</div>
            <div id="scalar-A-container"></div>
            <div class="equals">=</div>
            <div id="scalar-Result-container"></div>
        </div>

        <div id="scalar-steps-wrapper" class="explanation-section hidden">
            <div class="explanation-header">Sposób obliczeń</div>
            <div id="scalar-steps-container"></div>
        </div>
    </div>

    <div id="mul" class="tab-content">
        <div class="controls">
            <strong>A:</strong>
            <label>W:</label> <input type="number" id="mul-rows-a" value="2" min="1" max="5" onchange="resetAndRender('mul')">
            <label>K:</label> <input type="number" id="mul-cols-a" value="3" min="1" max="5" onchange="resetAndRender('mul')">
            
            <span style="margin:0 10px; color:#ccc">|</span>
            
            <strong>B:</strong>
            <label>W:</label> <input type="number" id="mul-rows-b" value="3" disabled title="Musi być równe kolumnom A" style="background:#eee">
            <label>K:</label> <input type="number" id="mul-cols-b" value="2" min="1" max="5" onchange="resetAndRender('mul')">
            
            <button class="action-btn" style="margin-left: 15px;" onclick="calculate('mul')">Oblicz wynik</button>
        </div>

        <div class="equation-container">
            <div id="mul-A-container"></div>
            <div class="operator">&times;</div>
            <div id="mul-B-container"></div>
            <div class="equals">=</div>
            <div id="mul-Result-container"></div>
        </div>

        <div id="mul-steps-wrapper" class="explanation-section hidden">
            <div class="explanation-header">Sposób obliczeń</div>
            <div id="mul-steps-container"></div>
        </div>
    </div>

</div>

<script>
    // Domyślne dane początkowe
    const defaultData = {
        add: { A: [[1, 2], [3, 4]], B: [[5, 6], [7, 8]] },
        sub: { A: [[10, 20], [30, 40]], B: [[1, 2], [3, 4]] },
        scalar: { A: [[1, -2], [4, 5]], k: 3 },
        mul: { A: [[1, 2, 3], [4, 5, 6]], B: [[7, 8], [9, 1], [2, 3]] }
    };

    window.onload = function() {
        // Inicjalizacja wszystkich zakładek
        renderInputs('add', defaultData.add);
        calculate('add'); // Od razu pokaż wynik dla pierwszej zakładki
        
        renderInputs('sub', defaultData.sub);
        renderInputs('scalar', defaultData.scalar);
        renderInputs('mul', defaultData.mul);
    };

    function openTab(tabName) {
        // Obsługa zakładek UI
        Array.from(document.getElementsByClassName('tab-content')).forEach(el => el.classList.remove('active'));
        Array.from(document.getElementsByClassName('tab-button')).forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');

        // Jeśli wynik nie jest jeszcze obliczony (pusty kontener wyniku), oblicz go
        const resultContainer = document.getElementById(`${tabName}-Result-container`);
        if (resultContainer.innerHTML === '') {
            calculate(tabName);
        }
    }

    // Funkcja wywoływana przy zmianie wymiarów (czyści wynik, resetuje inputy)
    function resetAndRender(type) {
        renderInputs(type);
        // Ukryj kroki i wyczyść wynik, bo wymiary się zmieniły
        document.getElementById(`${type}-steps-wrapper`).classList.add('hidden');
        document.getElementById(`${type}-Result-container`).innerHTML = '';
        
        // Dodaj placeholder "Kliknij Oblicz" w miejscu wyniku?
        // Na razie zostawiamy puste, żeby użytkownik kliknął
    }

    /**
     * Generuje HTML dla jednej macierzy
     */
    function createMatrixHTML(idPrefix, rows, cols, values = null, label = "", isReadOnly = false, isStep = false) {
        let gridHtml = `<div class="matrix-grid" style="grid-template-columns: repeat(${cols}, 1fr);">`;
        
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                // Wartość
                let val = '';
                if (values && values[i] && values[i][j] !== undefined) {
                    val = values[i][j];
                } else if (!isStep && !isReadOnly) {
                    val = 0; // domyślne zero dla inputów
                }

                if (isStep) {
                    // Dla kroków używamy divów lub spanów wewnątrz komórki, żeby tekst się zawijał ładnie
                    gridHtml += `<div class="step-cell">${val}</div>`;
                } else {
                    const extraClass = isReadOnly ? 'result-cell' : `${idPrefix}-cell`;
                    const readOnlyAttr = isReadOnly ? 'readonly' : '';
                    const typeAttr = 'type="number"';
                    gridHtml += `<input ${typeAttr} class="matrix-cell ${extraClass}" data-row="${i}" data-col="${j}" value="${val}" ${readOnlyAttr}>`;
                }
            }
        }
        gridHtml += `</div>`;

        return `
            <div class="matrix-wrapper">
                ${label ? `<div class="matrix-label">${label}</div>` : ''}
                <div class="matrix-brackets">
                    <div class="hook-right-top"></div>
                    <div class="hook-right-bottom"></div>
                    ${gridHtml}
                </div>
            </div>
        `;
    }

    function renderInputs(type, initialData = null) {
        if(type === 'mul') {
            // Synchronizacja wierszy B z kolumnami A
            const colsA = document.getElementById('mul-cols-a').value;
            document.getElementById('mul-rows-b').value = colsA;
        }

        // Pobranie wymiarów
        let rowsA, colsA, rowsB, colsB;
        
        if (type === 'add' || type === 'sub') {
            rowsA = rowsB = parseInt(document.getElementById(`${type}-rows`).value);
            colsA = colsB = parseInt(document.getElementById(`${type}-cols`).value);
        } else if (type === 'scalar') {
            rowsA = parseInt(document.getElementById('scal-rows').value);
            colsA = parseInt(document.getElementById('scal-cols').value);
        } else if (type === 'mul') {
            rowsA = parseInt(document.getElementById('mul-rows-a').value);
            colsA = parseInt(document.getElementById('mul-cols-a').value);
            rowsB = colsA;
            colsB = parseInt(document.getElementById('mul-cols-b').value);
        }

        // Renderowanie Macierzy A
        document.getElementById(`${type}-A-container`).innerHTML = 
            createMatrixHTML(`${type}-A`, rowsA, colsA, initialData ? initialData.A : null, "Macierz A");

        // Renderowanie Macierzy B (jeśli dotyczy)
        if (type !== 'scalar') {
            document.getElementById(`${type}-B-container`).innerHTML = 
                createMatrixHTML(`${type}-B`, rowsB, colsB, initialData ? initialData.B : null, "Macierz B");
        }

        // Skalar
        if (type === 'scalar' && initialData) {
            document.getElementById('scal-val').value = initialData.k;
        }
    }

    function getMatrixValues(className, rows, cols) {
        const inputs = document.querySelectorAll(`.${className}`);
        let matrix = [];
        let index = 0;
        for (let i = 0; i < rows; i++) {
            let row = [];
            for (let j = 0; j < cols; j++) {
                row.push(parseFloat(inputs[index].value) || 0);
                index++;
            }
            matrix.push(row);
        }
        return matrix;
    }

    function calculate(type) {
        const stepsWrapper = document.getElementById(`${type}-steps-wrapper`);
        const stepsContainer = document.getElementById(`${type}-steps-container`);
        const resultContainer = document.getElementById(`${type}-Result-container`);
        
        stepsWrapper.classList.remove('hidden');

        let rowsA, colsA, A, B, R, stepsMatrix;

        if (type === 'add' || type === 'sub') {
            rowsA = parseInt(document.getElementById(`${type}-rows`).value);
            colsA = parseInt(document.getElementById(`${type}-cols`).value);
            A = getMatrixValues(`${type}-A-cell`, rowsA, colsA);
            B = getMatrixValues(`${type}-B-cell`, rowsA, colsA);
            
            R = [];
            stepsMatrix = [];
            const isAdd = type === 'add';
            const sign = isAdd ? '+' : '-';

            for(let i=0; i<rowsA; i++) {
                let rRow = [];
                let sRow = [];
                for(let j=0; j<colsA; j++) {
                    const val = isAdd ? A[i][j] + B[i][j] : A[i][j] - B[i][j];
                    const valB_str = B[i][j] < 0 ? `(${B[i][j]})` : `${B[i][j]}`;
                    
                    rRow.push(val);
                    sRow.push(`${A[i][j]} ${sign} ${valB_str}`);
                }
                R.push(rRow);
                stepsMatrix.push(sRow);
            }

            // Render Result
            resultContainer.innerHTML = createMatrixHTML('res', rowsA, colsA, R, "Wynik", true);
            // Render Steps (jako macierz tekstowa)
            stepsContainer.innerHTML = createMatrixHTML('step', rowsA, colsA, stepsMatrix, "", false, true);

        } else if (type === 'scalar') {
            rowsA = parseInt(document.getElementById(`scal-rows`).value);
            colsA = parseInt(document.getElementById(`scal-cols`).value);
            const k = parseFloat(document.getElementById('scal-val').value);
            A = getMatrixValues(`scalar-A-cell`, rowsA, colsA);
            
            R = [];
            stepsMatrix = [];

            for(let i=0; i<rowsA; i++) {
                let rRow = [];
                let sRow = [];
                for(let j=0; j<colsA; j++) {
                    rRow.push(k * A[i][j]);
                    sRow.push(`${k} · ${A[i][j]}`);
                }
                R.push(rRow);
                stepsMatrix.push(sRow);
            }

            resultContainer.innerHTML = createMatrixHTML('res', rowsA, colsA, R, "Wynik", true);
            stepsContainer.innerHTML = createMatrixHTML('step', rowsA, colsA, stepsMatrix, "", false, true);

        } else if (type === 'mul') {
            rowsA = parseInt(document.getElementById('mul-rows-a').value);
            colsA = parseInt(document.getElementById('mul-cols-a').value);
            const colsB = parseInt(document.getElementById('mul-cols-b').value);
            
            A = getMatrixValues('mul-A-cell', rowsA, colsA);
            // B rows = colsA
            B = getMatrixValues('mul-B-cell', colsA, colsB);
            
            R = [];
            stepsMatrix = [];

            for (let i = 0; i < rowsA; i++) {
                let rRow = [];
                let sRow = [];
                for (let j = 0; j < colsB; j++) {
                    let sum = 0;
                    let formulaParts = [];
                    for (let k = 0; k < colsA; k++) {
                        sum += A[i][k] * B[k][j];
                        // Budowanie krótkiego stringa: a*b
                        formulaParts.push(`${A[i][k]}·${B[k][j]}`);
                    }
                    rRow.push(sum);
                    // Łączenie stringów: a*b + c*d
                    sRow.push(formulaParts.join(' + '));
                }
                R.push(rRow);
                stepsMatrix.push(sRow);
            }
            
            // Render Result
            resultContainer.innerHTML = createMatrixHTML('res', rowsA, colsB, R, "Wynik", true);
            
            // Render Steps (jako macierz, ale tekstowa!) - To jest zmiana, żeby nie było długiej listy
            stepsContainer.innerHTML = createMatrixHTML('step-mul', rowsA, colsB, stepsMatrix, "", false, true);
        }
    }
</script>

</body>
</html>