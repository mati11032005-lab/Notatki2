<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wizualizator Wektorów 3D Pro</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script>
        MathJax = {
          tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
          svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        :root {
            --bg-app: #121212;
            --bg-panel: #1e1e2e;
            --bg-input: #2a2a3c;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0b0;
            --accent-dot: #FF9F1C;
            --accent-cross: #CB6CE6;
            --accent-mixed: #2EC4B6;
            --vec-a: #ff5252;
            --vec-b: #448aff;
            --vec-c: #69f0ae;
            --vec-res: #CB6CE6;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0; background-color: var(--bg-app); color: var(--text-primary);
            height: 100vh; display: flex; flex-direction: column;
        }

        .main-container {
            display: grid; grid-template-columns: 400px 1fr; flex-grow: 1; height: 100%; overflow: hidden;
        }

        .controls-panel {
            background: var(--bg-panel); padding: 25px; display: flex; flex-direction: column;
            gap: 25px; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.3); z-index: 10;
        }

        h1 { font-size: 1.4rem; margin: 0; font-weight: 600; }
        .panel-section { display: flex; flex-direction: column; gap: 15px; }

        .mode-tabs { display: flex; background: var(--bg-input); padding: 5px; border-radius: 12px; }
        .tab-btn {
            flex: 1; padding: 10px; border: none; background: transparent; color: var(--text-secondary);
            cursor: pointer; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;
        }
        .tab-btn.active.dot { background: var(--accent-dot); color: white; }
        .tab-btn.active.cross { background: var(--accent-cross); color: white; }
        .tab-btn.active.mixed { background: var(--accent-mixed); color: white; }

        .vector-card {
            background: rgba(255,255,255,0.03); border-radius: 12px; padding: 15px 20px;
            border-left: 4px solid transparent;
        }
        .card-a { border-color: var(--vec-a); } .card-b { border-color: var(--vec-b); } .card-c { border-color: var(--vec-c); }

        .vector-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: 600; font-size: 0.9rem; }
        .label-a { color: var(--vec-a); } .label-b { color: var(--vec-b); } .label-c { color: var(--vec-c); }

        .inputs-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .input-wrapper { display: flex; flex-direction: column; align-items: center; }
        .input-wrapper label { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px; }
        input[type="number"] {
            width: 100%; padding: 8px 5px; background: var(--bg-input); border: 1px solid transparent;
            border-radius: 6px; color: var(--text-primary); text-align: center; font-weight: 500;
            
        }
        input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"]:focus { outline: none; border-color: var(--text-secondary); }

        .results-container {
            background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; flex-grow: 1; display: flex; flex-direction: column;
        }
        .results-title { font-weight: 600; color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem; }
        #calc-steps { font-size: 1rem; overflow-x: auto; flex-grow: 1; scrollbar-width: thin; scrollbar-color: var(--bg-input) transparent; }

        .visualization-panel { position: relative; width: 100%; height: 100%; }
        #plotDiv { width: 100%; height: 100%; }

        @media (max-width: 900px) {
            .main-container { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
            .controls-panel { max-height: 50vh; padding: 15px; }
            .visualization-panel { height: 50vh; min-height: 300px; }
        }
    </style>
</head>
<body>

<div class="main-container">
    <div class="controls-panel">
        <h1>Kalkulator Wektorów 3D</h1>
        <div class="panel-section">
            <div class="mode-tabs">
                <button class="tab-btn active dot" onclick="setMode('dot')">Skalarny</button>
                <button class="tab-btn cross" onclick="setMode('cross')">Wektorowy</button>
                <button class="tab-btn mixed" onclick="setMode('mixed')">Mieszany</button>
            </div>
        </div>
        <div class="panel-section">
            <div class="vector-card card-a">
                <div class="vector-header"><span class="label-a">Wektor A</span></div>
                <div class="inputs-grid">
                    <div class="input-wrapper"><label>X</label><input type="number" id="ax" value="3" oninput="update()"></div>
                    <div class="input-wrapper"><label>Y</label><input type="number" id="ay" value="2" oninput="update()"></div>
                    <div class="input-wrapper"><label>Z</label><input type="number" id="az" value="5" oninput="update()"></div>
                </div>
            </div>
            <div class="vector-card card-b">
                <div class="vector-header"><span class="label-b">Wektor B</span></div>
                <div class="inputs-grid">
                    <div class="input-wrapper"><label>X</label><input type="number" id="bx" value="1" oninput="update()"></div>
                    <div class="input-wrapper"><label>Y</label><input type="number" id="by" value="-4" oninput="update()"></div>
                    <div class="input-wrapper"><label>Z</label><input type="number" id="bz" value="2" oninput="update()"></div>
                </div>
            </div>
            <div class="vector-card card-c" id="vec-c-container" style="display: none;">
                <div class="vector-header"><span class="label-c">Wektor C</span></div>
                <div class="inputs-grid">
                    <div class="input-wrapper"><label>X</label><input type="number" id="cx" value="2" oninput="update()"></div>
                    <div class="input-wrapper"><label>Y</label><input type="number" id="cy" value="1" oninput="update()"></div>
                    <div class="input-wrapper"><label>Z</label><input type="number" id="cz" value="-3" oninput="update()"></div>
                </div>
            </div>
        </div>
        <div class="results-container">
            <span class="results-title">KROKI OBLICZEŃ I WYNIK:</span>
            <div id="calc-steps"></div>
        </div>
    </div>
    <div class="visualization-panel">
        <div id="plotDiv"></div>
    </div>
</div>

<script>
    let currentMode = 'dot';
    const colors = { bg: '#121212', grid: '#2a2a3c', text: '#e0e0e0', a: '#ff5252', b: '#448aff', c: '#69f0ae', res: '#CB6CE6' };

    document.addEventListener('DOMContentLoaded', () => {
        Plotly.newPlot('plotDiv', [], getLayout(), {displayModeBar: false});
        update();
    });

    function setMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
            if(btn.classList.contains(mode)) btn.classList.add('active');
        });
        document.getElementById('vec-c-container').style.display = (mode === 'mixed') ? 'block' : 'none';
        update();
    }

    function getVal(id) {
        const el = document.getElementById(id);
        if (!el || el.value.trim() === '' || el.value.trim() === '-') return 0;
        const val = parseFloat(el.value);
        return isNaN(val) ? 0 : val;
    }

    // Funkcja pomocnicza do formatowania liczb ujemnych w nawiasach
    function fmt(num) {
        return num < 0 ? `(${num})` : `${num}`;
    }

    function update() {
        const A = { x: getVal('ax'), y: getVal('ay'), z: getVal('az') };
        const B = { x: getVal('bx'), y: getVal('by'), z: getVal('bz') };
        const C = { x: getVal('cx'), y: getVal('cy'), z: getVal('cz') };

        let resultHtml = '';
        let resultVector = null;

        if (currentMode === 'dot') {
            const dot = (A.x * B.x) + (A.y * B.y) + (A.z * B.z);
            resultHtml = `
                $$ \\vec{A} \\circ \\vec{B} = a_x b_x + a_y b_y + a_z b_z $$
                $$ = ${fmt(A.x)} \\cdot ${fmt(B.x)} + ${fmt(A.y)} \\cdot ${fmt(B.y)} + ${fmt(A.z)} \\cdot ${fmt(B.z)} $$
                $$ = ${fmt(A.x*B.x)} + ${fmt(A.y*B.y)} + ${fmt(A.z*B.z)} $$
                $$ \\text{Wynik} = \\mathbf{${Number(dot.toFixed(4))}} $$
            `;
        } else if (currentMode === 'cross') {
            // --- NAPRAWIONA SEKCJA ---
            const term_i1 = A.y * B.z; const term_i2 = A.z * B.y; const rx = term_i1 - term_i2;
            const term_j1 = A.x * B.z; const term_j2 = A.z * B.x; const ry_neg = term_j1 - term_j2; const ry = -ry_neg;
            const term_k1 = A.x * B.y; const term_k2 = A.y * B.x; const rz = term_k1 - term_k2;
            resultVector = { x: rx, y: ry, z: rz };
            
            resultHtml = `
                $$ \\vec{A} \\times \\vec{B} = \\begin{vmatrix} \\mathbf{i} & \\mathbf{j} & \\mathbf{k} \\\\ ${A.x} & ${A.y} & ${A.z} \\\\ ${B.x} & ${B.y} & ${B.z} \\end{vmatrix} $$
                
                $$ \\mathbf{i} [ ${fmt(A.y)} \\cdot ${fmt(B.z)} - ${fmt(A.z)} \\cdot ${fmt(B.y)} ] = \\mathbf{i} [ ${fmt(term_i1)} - ${fmt(term_i2)} ] = \\mathbf{i}(${rx}) $$

                $$ -\\mathbf{j} [ ${fmt(A.x)} \\cdot ${fmt(B.z)} - ${fmt(A.z)} \\cdot ${fmt(B.x)} ] = -\\mathbf{j} [ ${fmt(term_j1)} - ${fmt(term_j2)} ] = -\\mathbf{j}(${ry_neg}) = \\mathbf{j}(${ry}) $$

                $$ \\mathbf{k} [ ${fmt(A.x)} \\cdot ${fmt(B.y)} - ${fmt(A.y)} \\cdot ${fmt(B.x)} ] = \\mathbf{k} [ ${fmt(term_k1)} - ${fmt(term_k2)} ] = \\mathbf{k}(${rz}) $$

                <br>
                $$ \\text{Wynik} = [\\mathbf{${rx}}, \\mathbf{${ry}}, \\mathbf{${rz}}] $$
            `;
            // -------------------------
        } else if (currentMode === 'mixed') {
            const detX = (B.y * C.z) - (B.z * C.y);
            const detY = (B.x * C.z) - (B.z * C.x);
            const detZ = (B.x * C.y) - (B.y * C.x);
            const mixed = (A.x * detX) - (A.y * detY) + (A.z * detZ);
            resultHtml = `
                $$ (\\vec{A} \\times \\vec{B}) \\circ \\vec{C} = \\det(\\vec{A}, \\vec{B}, \\vec{C}) $$
                $$ = a_x(${fmt(B.y)}\\cdot${fmt(C.z)} - ${fmt(B.z)}\\cdot${fmt(C.y)}) - a_y(${fmt(B.x)}\\cdot${fmt(C.z)} - ${fmt(B.z)}\\cdot${fmt(C.x)}) + a_z(${fmt(B.x)}\\cdot${fmt(C.y)} - ${fmt(B.y)}\\cdot${fmt(C.x)}) $$
                $$ = ${fmt(A.x)}(${fmt(detX)}) - ${fmt(A.y)}(${fmt(detY)}) + ${fmt(A.z)}(${fmt(detZ)}) $$
                $$ = ${fmt(A.x*detX)} - ${fmt(A.y*detY)} + ${fmt(A.z*detZ)} $$
                $$ \\text{Wynik} = \\mathbf{${Number(mixed.toFixed(4))}} $$
            `;
        }

        const calcContainer = document.getElementById('calc-steps');
        calcContainer.innerHTML = resultHtml;
        MathJax.typesetPromise([calcContainer]);
        draw3D(A, B, C, resultVector);
    }

    function getLayout() {
        const axisStyle = {
            showgrid: true, zeroline: true, showline: true,
            gridcolor: colors.grid, zerolinecolor: '#555', linecolor: colors.grid,
            tickfont: { color: colors.text }, titlefont: { color: colors.text }
        };
        return {
            paper_bgcolor: colors.bg, plot_bgcolor: colors.bg, margin: { l:0, r:0, b:0, t:0 },
            scene: { aspectmode:'cube', xaxis:{...axisStyle, title:'X'}, yaxis:{...axisStyle, title:'Y'}, zaxis:{...axisStyle, title:'Z'}, camera:{eye:{x:1.6, y:1.6, z:1.6}} },
            showlegend: true, legend: { x: 0.02, y: 0.98, bgcolor: 'rgba(30,30,46,0.8)', font: {color: colors.text} }
        };
    }

    function draw3D(A, B, C, resVec) {
        const data = [];
        const createTrace = (vec, name, color) => ({
            type: 'scatter3d', mode: 'lines+markers', name: name,
            x: [0, vec.x], y: [0, vec.y], z: [0, vec.z],
            line: { width: 8, color: color }, marker: { size: 5, color: color },
            hoverinfo: 'text', text: `Koniec ${name}: (${vec.x}, ${vec.y}, ${vec.z})`
        });
        const createCone = (vec, color) => ({
            type: 'cone', x: [vec.x], y: [vec.y], z: [vec.z], u: [vec.x], v: [vec.y], w: [vec.z],
            sizemode: 'scaled', sizeref: 0.4, showscale: false, colorscale: [[0, color], [1, color]], hoverinfo: 'none'
        });

        data.push(createTrace(A, 'A', colors.a), createCone(A, colors.a));
        data.push(createTrace(B, 'B', colors.b), createCone(B, colors.b));
        if (currentMode === 'mixed') data.push(createTrace(C, 'C', colors.c), createCone(C, colors.c));
        if (currentMode === 'cross' && resVec) data.push(createTrace(resVec, 'Wynik (A×B)', colors.res), createCone(resVec, colors.res));
        data.push({ type: 'scatter3d', mode: 'markers', x:[0], y:[0], z:[0], marker:{size:4, color:colors.text}, name:'Zero', showlegend:false, hoverinfo:'none'});

        Plotly.react('plotDiv', data, getLayout(), {responsive: true, displayModeBar: false});
    }
</script>
</body>
</html>