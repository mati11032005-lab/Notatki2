<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator WyznacznikÃ³w Macierzy PRO</title>
    <style>
        :root {
            --primary: #7c3aed;
            --primary-hover: #6d28d9;
            --bg: #f8fafc;
            --panel: #ffffff;
            --border: #e2e8f0;
            --text-main: #1e293b;
            --highlight-pos: #16a34a;
            --highlight-neg: #dc2626;
            --math-font: 'Times New Roman', Times, serif;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 950px;
            margin: 0 auto;
            background-color: var(--panel);
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Tabs */
        .tabs { display: flex; background-color: #f1f5f9; border-bottom: 1px solid var(--border); }
        .tab-btn {
            flex: 1; padding: 18px; border: none; background: none; cursor: pointer;
            font-size: 16px; font-weight: 600; color: #64748b; transition: 0.2s;
        }
        .tab-btn:hover { background-color: #e2e8f0; }
        .tab-btn.active { background-color: var(--panel); color: var(--primary); border-top: 4px solid var(--primary); }

        .content { display: none; padding: 30px; animation: fadeEffect 0.4s; }
        .content.active { display: block; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

        /* Controls */
        .controls {
            display: flex; align-items: center; gap: 15px; margin-bottom: 25px;
            background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid var(--border);
        }
        .btn-calc {
            background-color: var(--primary); color: white; border: none; padding: 10px 24px;
            border-radius: 6px; font-weight: bold; cursor: pointer; margin-left: auto; transition: 0.2s;
        }
        .btn-calc:hover { background-color: var(--primary-hover); }
        input[type="number"] { padding: 6px; width: 50px; text-align: center; border: 1px solid #cbd5e1; border-radius: 4px; }

        /* Matrix Input */
        .matrix-grid { display: grid; gap: 8px; justify-content: center; margin-bottom: 20px; }
        .matrix-cell { width: 50px; height: 40px; text-align: center; font-size: 16px; border: 1px solid #cbd5e1; border-radius: 4px; }

        /* Matrix Styling (Brackets) */
        .matrix-wrapper { display: inline-block; position: relative; padding: 0 10px; vertical-align: middle; }
        .matrix-wrapper::before, .matrix-wrapper::after {
            content: ""; position: absolute; top: 0; bottom: 0; width: 8px; border: 2px solid #334155; border-right: none;
        }
        .matrix-wrapper::before { left: 0; }
        .matrix-wrapper::after { right: 0; transform: scaleX(-1); }

        /* Tip Box */
        .tip-box {
            background-color: #fff7ed; border-left: 4px solid #f97316; padding: 15px;
            margin-bottom: 25px; border-radius: 4px;
        }
        .tip-title { font-weight: bold; color: #9a3412; margin-bottom: 5px; display: block; }

        /* Results */
        .result-area { border-top: 2px dashed var(--border); padding-top: 20px; margin-top: 20px; }
        .final-answer {
            font-size: 1.5em; color: var(--primary); font-weight: bold; text-align: center;
            margin: 20px 0; padding: 15px; background: #f3e8ff; border-radius: 8px;
        }
        .step { margin-bottom: 15px; font-family: 'Courier New', monospace; padding: 10px; background: white; border: 1px solid #f1f5f9; border-radius: 6px; }

        /* Sarrus Visuals */
        .diag-pos { color: var(--highlight-pos); font-weight: bold; }
        .diag-neg { color: var(--highlight-neg); font-weight: bold; }

        /* --- STYLES FOR LAPLACE VISUALIZATION (Poprawki) --- */
        .laplace-equation {
            display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 10px;
            font-family: var(--math-font); font-size: 1.1em;
        }
        .laplace-term {
            display: flex; align-items: center; gap: 5px; background: #fff;
            padding: 8px; border: 1px solid #e2e8f0; border-radius: 8px;
        }
        .term-sign { font-weight: bold; font-size: 1.2em; color: #64748b; }
        .term-value { font-weight: bold; color: var(--primary); font-size: 1.2em; }
        
        /* Minor Matrix Styling */
        .minor-wrapper { position: relative; padding: 0 6px; display: inline-block; }
        /* Pionowe kreski dla wyznacznika minora */
        .minor-wrapper::before, .minor-wrapper::after {
            content: ""; position: absolute; top: 0; bottom: 0; width: 2px; background: #000;
        }
        .minor-wrapper::before { left: 0; }
        .minor-wrapper::after { right: 0; }
        
        .minor-grid { display: grid; gap: 3px; }
        .minor-cell {
            width: 25px; height: 25px; display: flex; align-items: center; justify-content: center;
            font-size: 0.9em; color: #334155;
        }

        /* Gauss formatting */
        table.gauss-table { margin: 10px auto; border-spacing: 0; border-collapse: collapse; }
        table.gauss-table td { padding: 5px 10px; text-align: right; width: 45px; }
        .gauss-bracket-left { border-left: 2px solid #000; border-top: 2px solid #000; border-bottom: 2px solid #000; width: 8px; }
        .gauss-bracket-right { border-right: 2px solid #000; border-top: 2px solid #000; border-bottom: 2px solid #000; width: 8px; }

    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('sarrus')">ReguÅ‚a Sarrusa</button>
        <button class="tab-btn" onclick="switchTab('laplace')">RozwiniÄ™cie Laplace'a</button>
        <button class="tab-btn" onclick="switchTab('gauss')">Metoda TrÃ³jkÄ…tna (Gauss)</button>
    </div>

    <div id="sarrus" class="content active">
        <div class="tip-box">
            <span class="tip-title">ðŸ’¡ Kiedy stosowaÄ‡?</span>
            Tylko dla macierzy <strong>3x3</strong>. Dopisujemy dwie pierwsze kolumny i mnoÅ¼ymy po przekÄ…tnych (schemat Sarrusa ).
        </div>
        <div class="controls">
            <span>Macierz jest staÅ‚a (3x3)</span>
            <button class="btn-calc" onclick="calcSarrus()">Oblicz Det(A)</button>
        </div>
        <div id="input-sarrus" class="matrix-wrapper"></div>
        <div id="res-sarrus" class="result-area" style="display:none;"></div>
    </div>

    <div id="laplace" class="content">
        <div class="tip-box">
            <span class="tip-title">ðŸ’¡ Kiedy stosowaÄ‡?</span>
            Dla macierzy 3x3, 4x4 i wiÄ™kszych. Rozwijamy wzglÄ™dem wiersza/kolumny z najwiÄ™kszÄ… liczbÄ… zer .
        </div>
        <div class="controls">
            <label>Rozmiar N:</label> 
            <input type="number" id="lap-size" value="3" min="2" max="4" onchange="renderMatrix('laplace', this.value)">
            <button class="btn-calc" onclick="calcLaplace()">Oblicz Det(A)</button>
        </div>
        <div style="text-align: center;">
            <div id="input-laplace" class="matrix-wrapper"></div>
        </div>
        <div id="res-laplace" class="result-area" style="display:none;"></div>
    </div>

    <div id="gauss" class="content">
        <div class="tip-box">
            <span class="tip-title">ðŸ’¡ Kiedy stosowaÄ‡?</span>
            Dla duÅ¼ych macierzy. Sprowadzamy macierz do postaci trÃ³jkÄ…tnej gÃ³rnej, a wyznacznik to iloczyn elementÃ³w na przekÄ…tnej.
        </div>
        <div class="controls">
            <label>Rozmiar N:</label> 
            <input type="number" id="gauss-size" value="4" min="2" max="5" onchange="renderMatrix('gauss', this.value)">
            <button class="btn-calc" onclick="calcGauss()">Oblicz Det(A)</button>
        </div>
        <div style="text-align: center;">
            <div id="input-gauss" class="matrix-wrapper"></div>
        </div>
        <div id="res-gauss" class="result-area" style="display:none;"></div>
    </div>
</div>

<script>
    // Inicjalizacja
    window.onload = function() {
        renderMatrix('sarrus', 3, [[2, 5, 7], [6, 3, 4], [5, -2, -3]]);
        renderMatrix('laplace', 3, [[1, 2, 3], [0, 4, 5], [1, 0, 6]]);
        renderMatrix('gauss', 4, [[1, 2, 3, 4], [1, 3, 5, 7], [10, 2, 4, 6], [2, 1, 1, 1]]);
    };

    function switchTab(id) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- GENERYCZNE FUNKCJE ---

    function renderMatrix(type, size, defaultVals = null) {
        const container = document.getElementById(`input-${type}`);
        container.innerHTML = '';
        const grid = document.createElement('div');
        grid.className = 'matrix-grid';
        grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;

        for(let i=0; i<size; i++) {
            for(let j=0; j<size; j++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.className = `matrix-cell ${type}-cell`;
                input.dataset.row = i; input.dataset.col = j;
                if(defaultVals && defaultVals[i]) input.value = defaultVals[i][j];
                else input.value = Math.floor(Math.random() * 10);
                grid.appendChild(input);
            }
        }
        container.appendChild(grid);
        document.getElementById(`res-${type}`).style.display = 'none';
    }

    function getMatrixValues(type) {
        const inputs = document.querySelectorAll(`.${type}-cell`);
        const size = Math.sqrt(inputs.length);
        let matrix = [];
        for(let i=0; i<size; i++) {
            let row = [];
            for(let j=0; j<size; j++) row.push(parseFloat(inputs[i*size + j].value) || 0);
            matrix.push(row);
        }
        return matrix;
    }

    // --- SARRUS (3x3) ---
    function calcSarrus() {
        const M = getMatrixValues('sarrus');
        const resDiv = document.getElementById('res-sarrus');
        resDiv.style.display = 'block';
        resDiv.innerHTML = '<h3>Wizualizacja metody Sarrusa</h3>';

        const p1 = M[0][0]*M[1][1]*M[2][2], p2 = M[0][1]*M[1][2]*M[2][0], p3 = M[0][2]*M[1][0]*M[2][1];
        const n1 = M[0][2]*M[1][1]*M[2][0], n2 = M[0][0]*M[1][2]*M[2][1], n3 = M[0][1]*M[1][0]*M[2][2];
        const det = (p1 + p2 + p3) - (n1 + n2 + n3);

        let html = `<div style="text-align:center; font-family:monospace; font-size:1.1em; letter-spacing:2px; margin-bottom:15px;">`;
        html += `<div>| ${M[0].join(' ')} | ${M[0][0]} ${M[0][1]}</div>`;
        html += `<div>| ${M[1].join(' ')} | ${M[1][0]} ${M[1][1]}</div>`;
        html += `<div>| ${M[2].join(' ')} | ${M[2][0]} ${M[2][1]}</div></div>`;
        
        html += `<div class="step"><span class="diag-pos">GÅ‚Ã³wne (+):</span> (${p1}) + (${p2}) + (${p3}) = <strong>${p1+p2+p3}</strong></div>`;
        html += `<div class="step"><span class="diag-neg">Boczne (-):</span> (${n1}) + (${n2}) + (${n3}) = <strong>${n1+n2+n3}</strong></div>`;
        html += `<div class="final-answer">Det = ${det}</div>`;
        resDiv.innerHTML += html;
    }

    // --- LAPLACE (Poprawiona Wizualizacja) ---
    function calcLaplace() {
        const M = getMatrixValues('laplace');
        const n = M.length;
        const resDiv = document.getElementById('res-laplace');
        resDiv.style.display = 'block';
        resDiv.innerHTML = '<h3>Wizualizacja (RozwiniÄ™cie wzg. 1. wiersza)</h3>';

        let stepsHtml = `<div style="text-align:center; margin-bottom:15px;">Det(A) = &Sigma; (-1)<sup>1+j</sup> Â· a<sub>1j</sub> Â· det(M<sub>1j</sub>)</div>`;
        stepsHtml += `<div class="laplace-equation">`;

        let totalDet = 0;

        for(let j=0; j<n; j++) {
            const val = M[0][j];
            const sign = ((1 + (j+1)) % 2 === 0) ? 1 : -1;
            const signChar = j === 0 ? (sign === 1 ? '' : '-') : (sign === 1 ? '+' : '-');
            
            // Tworzenie minora
            let minor = [];
            for(let row=1; row<n; row++) {
                let mRow = [];
                for(let col=0; col<n; col++) if(col !== j) mRow.push(M[row][col]);
                minor.push(mRow);
            }
            const minorDet = calculateSimpleDeterminant(minor);
            totalDet += sign * val * minorDet;

            // HTML dla minora (siatka)
            let minorGrid = `<div class="minor-grid" style="grid-template-columns: repeat(${n-1}, 1fr);">`;
            minor.flat().forEach(v => minorGrid += `<div class="minor-cell">${v}</div>`);
            minorGrid += `</div>`;

            stepsHtml += `
                <div class="laplace-term">
                    <span class="term-sign">${signChar}</span>
                    <span class="term-value">${val}</span>
                    <span>&times;</span>
                    <div class="minor-wrapper">${minorGrid}</div>
                </div>
            `;
        }
        stepsHtml += `</div>`; // End equation

        // Wynik tekstowy
        stepsHtml += `<div class="step" style="margin-top:20px; text-align:center;">`;
        let calcStr = "";
        for(let j=0; j<n; j++) {
            const val = M[0][j];
            const sign = ((1 + (j+1)) % 2 === 0) ? 1 : -1;
            // Recalculate minor det for display text
            let minor = [];
            for(let r=1; r<n; r++) { let rr=[]; for(let c=0; c<n; c++) if(c!==j) rr.push(M[r][c]); minor.push(rr); }
            const mDet = calculateSimpleDeterminant(minor);
            
            calcStr += `${sign===1 ? '+' : '-'}(${val} Â· ${mDet}) `;
        }
        stepsHtml += `Suma: ${calcStr} = <strong>${totalDet}</strong></div>`;
        stepsHtml += `<div class="final-answer">Det(A) = ${totalDet}</div>`;
        
        resDiv.innerHTML += stepsHtml;
    }

    function calculateSimpleDeterminant(m) {
        if(m.length === 2) return (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
        if(m.length === 3) {
             return (m[0][0]*m[1][1]*m[2][2] + m[0][1]*m[1][2]*m[2][0] + m[0][2]*m[1][0]*m[2][1]) -
                    (m[0][2]*m[1][1]*m[2][0] + m[0][0]*m[1][2]*m[2][1] + m[0][1]*m[1][0]*m[2][2]);
        }
        return m[0][0];
    }

    // --- GAUSS (Poprawiona tabela) ---
    function calcGauss() {
        let M = JSON.parse(JSON.stringify(getMatrixValues('gauss')));
        const n = M.length;
        const resDiv = document.getElementById('res-gauss');
        resDiv.style.display = 'block';
        resDiv.innerHTML = '<h3>Eliminacja Gaussa</h3>';

        let html = '';
        let swapCount = 0;
        
        for (let i = 0; i < n; i++) {
            let pivot = M[i][i];
            
            if (Math.abs(pivot) < 1e-10) {
                let swapped = false;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(M[k][i]) > 1e-10) {
                        [M[i], M[k]] = [M[k], M[i]];
                        swapCount++;
                        html += `<div class="step" style="border-left:4px solid orange;">ðŸ”„ Zamiana W${i+1} <-> W${k+1}</div>`;
                        pivot = M[i][i]; swapped = true; break;
                    }
                }
                if (!swapped && Math.abs(pivot) < 1e-10) {
                    resDiv.innerHTML = `<div class="final-answer">Det = 0 (Kolumna zerowa)</div>`; return;
                }
            }

            for (let j = i + 1; j < n; j++) {
                if (Math.abs(M[j][i]) > 1e-10) {
                    const factor = M[j][i] / M[i][i];
                    html += `<div class="step">W${j+1} = W${j+1} - (${parseFloat(factor.toFixed(2))}) Â· W${i+1}</div>`;
                    for (let k = i; k < n; k++) M[j][k] -= factor * M[i][k];
                }
            }
            html += renderGaussMatrix(M);
        }

        let det = (swapCount % 2 !== 0 ? -1 : 1);
        let diagStr = (swapCount % 2 !== 0 ? "(-1) Â· " : "");
        for(let i=0; i<n; i++) {
            det *= M[i][i];
            diagStr += parseFloat(M[i][i].toFixed(2)) + (i<n-1 ? " Â· " : "");
        }
        
        html += `<div class="step">Iloczyn przekÄ…tnej: ${diagStr}</div>`;
        html += `<div class="final-answer">Det(A) â‰ˆ ${parseFloat(det.toFixed(2))}</div>`;
        resDiv.innerHTML += html;
    }

    function renderGaussMatrix(M) {
        let h = '<table class="gauss-table"><tr><td class="gauss-bracket-left"></td>';
        h += '<td><table style="border-collapse:collapse;">';
        M.forEach(row => {
            h += '<tr>';
            row.forEach(val => h += `<td>${parseFloat(val.toFixed(2))}</td>`);
            h += '</tr>';
        });
        h += '</table></td>';
        h += '<td class="gauss-bracket-right"></td></tr></table>';
        return h;
    }

</script>

</body>
</html>