<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator WyznacznikÃ³w Macierzy</title>
    <style>
        :root {
            --primary: #7c3aed; /* Fioletowy motyw dla odmiany */
            --primary-hover: #6d28d9;
            --bg: #f8fafc;
            --panel: #ffffff;
            --border: #e2e8f0;
            --text-main: #1e293b;
            --highlight-pos: #16a34a; /* Zielony dla dodatnich */
            --highlight-neg: #dc2626; /* Czerwony dla ujemnych */
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--panel);
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background-color: #f1f5f9;
            border-bottom: 1px solid var(--border);
        }

        .tab-btn {
            flex: 1;
            padding: 18px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #64748b;
            transition: 0.2s;
        }

        .tab-btn:hover { background-color: #e2e8f0; }
        .tab-btn.active {
            background-color: var(--panel);
            color: var(--primary);
            border-top: 4px solid var(--primary);
        }

        .content {
            display: none;
            padding: 30px;
            animation: fadeEffect 0.4s;
        }
        .content.active { display: block; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

        /* Controls */
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .btn-calc {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-left: auto;
            transition: 0.2s;
        }
        .btn-calc:hover { background-color: var(--primary-hover); }

        input[type="number"] {
            padding: 6px;
            width: 50px;
            text-align: center;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
        }

        /* Matrix Input Grid */
        .matrix-grid {
            display: grid;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .matrix-cell {
            width: 50px;
            height: 40px;
            text-align: center;
            font-size: 16px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
        }

        /* Decoration for matrix brackets */
        .matrix-wrapper {
            display: inline-block;
            position: relative;
            padding: 0 10px;
        }
        .matrix-wrapper::before, .matrix-wrapper::after {
            content: "";
            position: absolute;
            top: 0; bottom: 0;
            width: 8px;
            border: 2px solid #334155;
            border-right: none;
        }
        .matrix-wrapper::before { left: 0; }
        .matrix-wrapper::after { right: 0; transform: scaleX(-1); }

        /* Tip Box */
        .tip-box {
            background-color: #fff7ed;
            border-left: 4px solid #f97316;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 4px;
        }
        .tip-title {
            font-weight: bold;
            color: #9a3412;
            margin-bottom: 5px;
            display: block;
        }

        /* Result Area */
        .result-area {
            border-top: 2px dashed var(--border);
            padding-top: 20px;
            margin-top: 20px;
        }

        .final-answer {
            font-size: 1.5em;
            color: var(--primary);
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f3e8ff;
            border-radius: 8px;
        }

        /* Visualization Styling */
        .step {
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            padding: 10px;
            background: white;
            border: 1px solid #f1f5f9;
            border-radius: 6px;
        }
        .math-row {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .sarrus-visual {
            display: grid;
            gap: 5px;
            justify-content: center;
            font-weight: bold;
            margin: 15px 0;
            color: #64748b;
        }
        .diag-pos { color: var(--highlight-pos); } /* PrzekÄ…tna gÅ‚Ã³wna */
        .diag-neg { color: var(--highlight-neg); } /* PrzekÄ…tna boczna */

        /* Laplace specific */
        .minor-matrix {
            display: inline-grid;
            gap: 2px;
            vertical-align: middle;
            border-left: 1px solid black;
            border-right: 1px solid black;
            padding: 0 4px;
            margin: 0 5px;
            font-size: 0.8em;
        }
        
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('sarrus')">ReguÅ‚a Sarrusa</button>
        <button class="tab-btn" onclick="switchTab('laplace')">RozwiniÄ™cie Laplace'a</button>
        <button class="tab-btn" onclick="switchTab('gauss')">Metoda TrÃ³jkÄ…tna (Gauss)</button>
    </div>

    <div id="sarrus" class="content active">
        <div class="tip-box">
            <span class="tip-title">ðŸ’¡ Kiedy stosowaÄ‡?</span>
            Metoda dziaÅ‚a <strong>TYLKO dla macierzy 3x3</strong>. Jest najszybsza do liczenia rÄ™cznego "na kartce" dla tego rozmiaru. Polega na dopisaniu dwÃ³ch pierwszych kolumn i mnoÅ¼eniu po przekÄ…tnych.
        </div>

        <div class="controls">
            <span>Macierz jest staÅ‚a (3x3)</span>
            <button class="btn-calc" onclick="calcSarrus()">Oblicz Det(A)</button>
        </div>

        <div id="input-sarrus" class="matrix-wrapper"></div>

        <div id="res-sarrus" class="result-area" style="display:none;"></div>
    </div>

    <div id="laplace" class="content">
        <div class="tip-box">
            <span class="tip-title">ðŸ’¡ Kiedy stosowaÄ‡?</span>
            Dobra dla macierzy 3x3 lub 4x4, szczegÃ³lnie gdy w macierzy wystÄ™puje <strong>duÅ¼o zer</strong>. Rozwijamy wzglÄ™dem wiersza lub kolumny z najwiÄ™kszÄ… liczbÄ… zer, co upraszcza obliczenia.
        </div>

        <div class="controls">
            <label>Rozmiar N:</label> 
            <input type="number" id="lap-size" value="3" min="2" max="4" onchange="renderMatrix('laplace', this.value)">
            <button class="btn-calc" onclick="calcLaplace()">Oblicz Det(A)</button>
        </div>

        <div style="text-align: center;">
            <div id="input-laplace" class="matrix-wrapper"></div>
        </div>

        <div id="res-laplace" class="result-area" style="display:none;"></div>
    </div>

    <div id="gauss" class="content">
        <div class="tip-box">
            <span class="tip-title">ðŸ’¡ Kiedy stosowaÄ‡?</span>
            Najlepsza metoda dla <strong>duÅ¼ych macierzy</strong> (4x4, 5x5 i wiÄ™kszych). Komputery uÅ¼ywajÄ… wÅ‚aÅ›nie tej metody (rozkÅ‚ad LU). Polega na sprowadzeniu macierzy do postaci trÃ³jkÄ…tnej, gdzie wyznacznik to iloczyn elementÃ³w na przekÄ…tnej.
        </div>

        <div class="controls">
            <label>Rozmiar N:</label> 
            <input type="number" id="gauss-size" value="4" min="2" max="5" onchange="renderMatrix('gauss', this.value)">
            <button class="btn-calc" onclick="calcGauss()">Oblicz Det(A)</button>
        </div>

        <div style="text-align: center;">
            <div id="input-gauss" class="matrix-wrapper"></div>
        </div>

        <div id="res-gauss" class="result-area" style="display:none;"></div>
    </div>
</div>

<script>
    // Inicjalizacja
    window.onload = function() {
        renderMatrix('sarrus', 3, [[2, 5, 7], [6, 3, 4], [5, -2, -3]]);
        renderMatrix('laplace', 3, [[1, 2, 3], [0, 4, 5], [1, 0, 6]]);
        renderMatrix('gauss', 4, [[1, 2, 3, 4], [1, 3, 5, 7], [10, 2, 4, 6], [2, 1, 1, 1]]);
    };

    function switchTab(id) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- GENERYCZNE FUNKCJE DO MACIERZY ---

    function renderMatrix(type, size, defaultVals = null) {
        const container = document.getElementById(`input-${type}`);
        container.innerHTML = '';
        
        const grid = document.createElement('div');
        grid.className = 'matrix-grid';
        grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;

        for(let i=0; i<size; i++) {
            for(let j=0; j<size; j++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.className = `matrix-cell ${type}-cell`;
                input.dataset.row = i;
                input.dataset.col = j;
                // DomyÅ›lna wartoÅ›Ä‡
                if(defaultVals && defaultVals[i] && defaultVals[i][j] !== undefined) {
                    input.value = defaultVals[i][j];
                } else {
                    input.value = Math.floor(Math.random() * 10); // losowe dla testu jak puste
                }
                grid.appendChild(input);
            }
        }
        container.appendChild(grid);
        // Ukryj stary wynik
        document.getElementById(`res-${type}`).style.display = 'none';
    }

    function getMatrixValues(type) {
        const inputs = document.querySelectorAll(`.${type}-cell`);
        const size = Math.sqrt(inputs.length);
        let matrix = [];
        for(let i=0; i<size; i++) {
            let row = [];
            for(let j=0; j<size; j++) {
                row.push(parseFloat(inputs[i*size + j].value) || 0);
            }
            matrix.push(row);
        }
        return matrix;
    }

    // --- SARRUS (3x3) ---

    function calcSarrus() {
        const M = getMatrixValues('sarrus');
        const resDiv = document.getElementById('res-sarrus');
        resDiv.style.display = 'block';
        resDiv.innerHTML = '<h3>Wizualizacja metody Sarrusa</h3>';

        // Obliczenia
        const p1 = M[0][0]*M[1][1]*M[2][2];
        const p2 = M[0][1]*M[1][2]*M[2][0];
        const p3 = M[0][2]*M[1][0]*M[2][1];
        
        const n1 = M[0][2]*M[1][1]*M[2][0];
        const n2 = M[0][0]*M[1][2]*M[2][1];
        const n3 = M[0][1]*M[1][0]*M[2][2];

        const det = (p1 + p2 + p3) - (n1 + n2 + n3);

        // Wizualizacja "Dopisania kolumn"
        let html = `<div style="text-align:center; font-family:monospace; font-size:1.1em; letter-spacing:2px;">`;
        html += `<div>| ${M[0].join(' ')} | ${M[0][0]} ${M[0][1]}</div>`;
        html += `<div>| ${M[1].join(' ')} | ${M[1][0]} ${M[1][1]}</div>`;
        html += `<div>| ${M[2].join(' ')} | ${M[2][0]} ${M[2][1]}</div>`;
        html += `</div>`;
        
        html += `<div style="margin-top:20px;">`;
        html += `<div class="step"><span class="diag-pos">PrzekÄ…tne GÅ‚Ã³wne (+):</span> <br> (${M[0][0]}Â·${M[1][1]}Â·${M[2][2]}) + (${M[0][1]}Â·${M[1][2]}Â·${M[2][0]}) + (${M[0][2]}Â·${M[1][0]}Â·${M[2][1]}) <br>= <strong>${p1} + ${p2} + ${p3}</strong> = ${p1+p2+p3}</div>`;
        html += `<div class="step"><span class="diag-neg">PrzekÄ…tne Boczne (-):</span> <br> (${M[0][2]}Â·${M[1][1]}Â·${M[2][0]}) + (${M[0][0]}Â·${M[1][2]}Â·${M[2][1]}) + (${M[0][1]}Â·${M[1][0]}Â·${M[2][2]}) <br>= <strong>${n1} + ${n2} + ${n3}</strong> = ${n1+n2+n3}</div>`;
        html += `</div>`;

        html += `<div class="final-answer">Wyznacznik = ${p1+p2+p3} - (${n1+n2+n3}) = ${det}</div>`;
        
        resDiv.innerHTML += html;
    }

    // --- LAPLACE ---

    function calcLaplace() {
        const M = getMatrixValues('laplace');
        const n = M.length;
        const resDiv = document.getElementById('res-laplace');
        resDiv.style.display = 'block';
        resDiv.innerHTML = '<h3>Wizualizacja (rozwiniÄ™cie wzglÄ™dem 1. wiersza)</h3>';

        let html = `<div style="margin-bottom:15px;">WzÃ³r: &Sigma; (-1)<sup>1+j</sup> Â· a<sub>1j</sub> Â· det(M<sub>1j</sub>)</div>`;
        let totalDet = 0;
        let stepsHtml = '<div class="math-row" style="justify-content:center; font-size:1.1em;">Det(A) = ';

        for(let j=0; j<n; j++) {
            const a_1j = M[0][j];
            const sign = ((1 + (j+1)) % 2 === 0) ? 1 : -1; // (-1)^(i+j)
            const signSymbol = sign === 1 ? '+' : '-';
            
            // StwÃ³rz minor (wykreÅ›l wiersz 0 i kolumnÄ™ j)
            let minor = [];
            for(let row=1; row<n; row++) {
                let mRow = [];
                for(let col=0; col<n; col++) {
                    if(col !== j) mRow.push(M[row][col]);
                }
                minor.push(mRow);
            }

            // Oblicz wyznacznik minora (rekurencyjnie, ale tu uproszczamy dla demo - uÅ¼ywamy pomocniczej)
            const minorDet = calculateSimpleDeterminant(minor);
            const term = sign * a_1j * minorDet;
            totalDet += term;

            // Budowanie HTML minora
            let minorGrid = `<div class="minor-matrix" style="grid-template-columns: repeat(${n-1}, 1fr);">`;
            minor.flat().forEach(v => minorGrid += `<span>${v}</span>`);
            minorGrid += `</div>`;

            // JeÅ›li element to 0, moÅ¼na zaznaczyÄ‡, Å¼e pomijamy, ale pokaÅ¼my caÅ‚oÅ›Ä‡ dla nauki
            stepsHtml += `
                <div>
                    ${j > 0 ? (sign === 1 ? ' + ' : ' - ') : (sign === -1 ? '-' : '')} 
                    <strong>${a_1j}</strong> Â· ${minorGrid}
                </div>
            `;
        }
        stepsHtml += '</div>';

        // PokaÅ¼ obliczenia liczbowe
        stepsHtml += `<div class="step" style="margin-top:20px; text-align:center;">`;
        for(let j=0; j<n; j++) {
            const a_1j = M[0][j];
            const sign = ((1 + (j+1)) % 2 === 0) ? 1 : -1;
            
            // Minor hacky recalculation for display
            let minor = [];
            for(let row=1; row<n; row++) {
                let rowArr = [];
                for(let col=0; col<n; col++) if(col !== j) rowArr.push(M[row][col]);
                minor.push(rowArr);
            }
            const mDet = calculateSimpleDeterminant(minor);

            stepsHtml += `a<sub>1,${j+1}</sub>(${a_1j}) Â· wyznacznik(${mDet}) Â· znak(${sign > 0 ? '+1' : '-1'}) = <strong>${a_1j * mDet * sign}</strong><br>`;
        }
        stepsHtml += `</div>`;

        stepsHtml += `<div class="final-answer">Wyznacznik = ${totalDet}</div>`;
        resDiv.innerHTML += html + stepsHtml;
    }

    // Pomocnicza do obliczenia wyznacznika minora (dla 2x2 i 3x3) bez wizualizacji
    function calculateSimpleDeterminant(m) {
        if(m.length === 2) return (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
        if(m.length === 3) { // Sarrus logic in memory
             return (m[0][0]*m[1][1]*m[2][2] + m[0][1]*m[1][2]*m[2][0] + m[0][2]*m[1][0]*m[2][1]) -
                    (m[0][2]*m[1][1]*m[2][0] + m[0][0]*m[1][2]*m[2][1] + m[0][1]*m[1][0]*m[2][2]);
        }
        return m[0][0]; // fallback for 1x1
    }

    // --- GAUSS (TRIANGULACJA) ---

    function calcGauss() {
        // Deep copy
        let M = JSON.parse(JSON.stringify(getMatrixValues('gauss')));
        const n = M.length;
        const resDiv = document.getElementById('res-gauss');
        resDiv.style.display = 'block';
        resDiv.innerHTML = '<h3>Wizualizacja Eliminacji Gaussa</h3>';

        let html = '<div style="font-size:0.9em; color:#555; margin-bottom:10px;">Celem jest uzyskanie zer poniÅ¼ej gÅ‚Ã³wnej przekÄ…tnej.</div>';
        let swapCount = 0;
        
        for (let i = 0; i < n; i++) {
            // Szukanie pivota
            let pivot = M[i][i];
            
            // JeÅ›li pivot 0, trzeba zamieniÄ‡ wiersze
            if (Math.abs(pivot) < 1e-10) {
                let swapped = false;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(M[k][i]) > 1e-10) {
                        // Swap
                        let temp = M[i];
                        M[i] = M[k];
                        M[k] = temp;
                        swapCount++;
                        html += `<div class="step" style="border-left:4px solid orange;">ðŸ”„ Zamiana wiersza W${i+1} z W${k+1} (pivot byÅ‚ 0). Zmiana znaku wyznacznika!</div>`;
                        pivot = M[i][i];
                        swapped = true;
                        break;
                    }
                }
                if (!swapped && Math.abs(pivot) < 1e-10) {
                    html += `<div class="final-answer">Wyznacznik = 0 (kolumna zerowa)</div>`;
                    resDiv.innerHTML = html;
                    return;
                }
            }

            // Eliminacja wierszy poniÅ¼ej
            for (let j = i + 1; j < n; j++) {
                if (Math.abs(M[j][i]) > 1e-10) {
                    const factor = M[j][i] / M[i][i];
                    html += `<div class="step">Eliminacja w W${j+1}: <strong>W${j+1} = W${j+1} - (${parseFloat(factor.toFixed(2))}) Â· W${i+1}</strong></div>`;
                    
                    for (let k = i; k < n; k++) {
                        M[j][k] = M[j][k] - factor * M[i][k];
                    }
                }
            }
            // PokaÅ¼ stan macierzy po przetworzeniu kolumny
            html += renderMiniMatrix(M);
        }

        let det = 1;
        let diagHtml = "";
        for(let i=0; i<n; i++) {
            det *= M[i][i];
            diagHtml += parseFloat(M[i][i].toFixed(2)) + (i < n-1 ? " Â· " : "");
        }
        
        // Korekta znaku za zamiany wierszy
        if (swapCount % 2 !== 0) det *= -1;

        html += `<div class="step">MnoÅ¼enie elementÃ³w na przekÄ…tnej: ${diagHtml} = ${parseFloat(det.toFixed(2))}</div>`;
        if(swapCount % 2 !== 0) {
            html += `<div class="step" style="color:red;">UwzglÄ™dniono zmianÄ™ znaku (nieparzysta liczba zamian wierszy).</div>`;
        }

        html += `<div class="final-answer">Wyznacznik â‰ˆ ${parseFloat(det.toFixed(2))}</div>`;
        resDiv.innerHTML += html;
    }

    function renderMiniMatrix(M) {
        let h = '<table style="margin: 10px auto; border-left:2px solid #000; border-right:2px solid #000; padding:0 5px;">';
        M.forEach(row => {
            h += '<tr>';
            row.forEach(val => {
                h += `<td style="padding:5px; width:40px; text-align:center;">${parseFloat(val.toFixed(2))}</td>`;
            });
            h += '</tr>';
        });
        h += '</table>';
        return h;
    }

</script>

</body>
</html>